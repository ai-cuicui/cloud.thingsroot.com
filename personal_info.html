<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<link href="css/bootstrap.min.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<link href="css/animate.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="js/layui/css/layui.css"  media="all">
		<title>个人信息</title>
	</head>
	<body>
		<nav class="nav_herder">
			<div class="nav_left" onClick="location='index.html'"><img src="img/cloud_thingslink_logo.png" class="logo"/>冬笋物联网</div>
			<div class="pull-right nav_right">
				<p class="J_appCenter hd" onClick="location='shop.html'"><img src="img/top_appstore.png"/><span>应用商店</span><em>|</em></p>
				<p class="J_getMembers hd"><img src="img/top_management.png"/><span><!--成员管理--></span><em>|</em></p>
				<p><img src="img/top_news.png"/><em>|</em></p>
				<p onClick="location='personal_info.html'"><img src="img/top_avatar.png"/><span class="J_nickname">昵称</span><em>|</em></p>
				<p><img src="img/top_quit.png" id="J_logout"/></p>
			</div>
		</nav>
		<div class="down-main">
			<div class="left-main left-full">
				<div class="sidebar-fold">个人中心</div>
				<div class="subNav bg-color" onClick="location='personal_info.html'">
					<img src="img/personal_info.png" class="hd_img"/>
					<img src="img/personal_info_hover.png" class="hover_img"/>
					<p class="sublist-title">个人信息</p>
				</div>
				<div class="subNav" onClick="javascript:alt('开发中',4);">
					<img src="img/personal_collect.png" class="hd_img"/>
					<img src="img/personal_collect_hover.png" class="hover_img"/>
					<p class="sublist-title">我的收藏</p>
				</div>
				<div class="subNav" onClick="javascript:alt('开发中',4);">
					<img src="img/personal_news.png" class="hd_img"/>
					<img src="img/personal_news_hover.png" class="hover_img"/>
					<p class="sublist-title">消息中心</p>
				</div>
				<div class="subNav J_getMembers">
					<img src="img/personal_member.png" class="hd_img"/>
					<img src="img/personal_member_hover.png" class="hover_img"/>
					<p class="sublist-title">成员管理</p>
				</div>
				<div class="subNav" onClick="location='set.html'">
					<img src="img/personal_setup.png" class="hd_img"/>
					<img src="img/personal_setup_hover.png" class="hover_img"/>
					<p class="sublist-title">设置</p>
				</div>
	  		</div>
	  		<div class="right-product my-index right-full">
	  			<div class="rightHeight">
			  		<ol class="breadcrumb">
					    <li><img src="img/icon_nav.png" />个人中心</li>
					    <li class="active">个人信息</li>
					</ol>
					<div class="main_content personal_main">
						<div class="top cf">
							<span class="fl">个人信息</span>
						</div>
						<div class="personal_content">
							<div class="info_main">
								<p>头像</p>
								<div class="icon js_uploadBox">
									<button>编辑头像</button>
									<div class="js_showBox"></div>
									<input type="file" class="js_upFile" >
								</div>
							</div>
							<div class="info_main">
								<p>姓</p>
								<input type="text" value="" name="first_name" />
							</div>
							<div class="info_main">
								<p>名</p>
								<input type="text" value="" name="last_name" />
							</div>
							<div class="info_main">
								<p>电话</p>
								<input type="text" value="" name="phone" />
							</div>
							<!--<div class="info_main">
								<p>手机</p>
								<input type="text" value="" name="mobile_no" />
							</div>-->
							<!--<div class="info_main">
								<p>密码</p>
								<input type="text" value="" name="new_password" />
							</div>-->
							<div class="makesure J_updateUser">保存</div>
						</div>
					</div>
	  			</div>
				<div class="copyright">SymTech Application © 2008-2017</div>
	  		</div>
	  	</div>
	  	
	<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>	
	<script src="js/transport.js" type="text/javascript"></script>
	<script src="js/jQuery.cookie.js" type="text/javascript"></script>	
	<script src="js/layui/layui.js" charset="utf-8"></script>
	<script src="js/bootstrap.min.js" type="text/javascript"></script>
	<script src="js/arrayFun.js" type="text/javascript"></script>
	<script src="js/common.js" type="text/javascript"></script>
	<script src="js/user.js" type="text/javascript"></script>		
	<script src="js/jquery.uploadView.js" type="text/javascript"></script>
	
	<script src="js/index.js" type="text/javascript"></script>
	<script>
		$(function(){
//			上传头像
			$(".js_upFile").uploadView({
				uploadBox: '.js_uploadBox',//设置上传框容器
				showBox : '.js_showBox',//设置显示预览图片的容器
				allowType: ["gif", "jpeg", "jpg", "bmp", "png"], //允许上传图片的类型
				maxSize :2, //允许上传图片的最大尺寸，单位M
				success:function(e){
					var imagesrc = $(".js_showBox img").attr("src").split(',');
		            var image_base64 = imagesrc[1];
		            var api_key = "98lLFi5YCWsBxBFD3OSx5rTeVR6OmL80";
		            var api_secret = "4_NPTWfkEkl_ao215Vqqx3d5GLHexG2a";
		            $.ajax({
		                url: "https://api-cn.faceplusplus.com/cardpp/v1/ocridcard",
		                type: "POST",
		                dataType: "json",
		                enctype: 'multipart/form-data',
		                data: {api_key:api_key,api_secret:api_secret,image_base64:image_base64},
		                success:function(data){
		                    $.each(data.cards,function(i,item){
		                          $('input[name=linkman]').val(item.name);
		                          $('input[name=sfcode]').val(item.id_card_number);
		                    })
		                }
		            });
				}
			});
			
			// 用户信息回显
			var usr = getCookie('usr');
			Ajax.call('/api/resource/User/'+usr,'', displayUserFun, 'GET', 'JSON', 'FORM');
			function displayUserFun(req) {
				$("input[name=first_name]").val(req.data.first_name);
				$("input[name=last_name]").val(req.data.last_name);
				$("input[name=phone]").val(req.data.phone);
				$("input[name=mobile_no]").val(req.data.mobile_no);
				console.log(req);
			}
			// 修改个人信息
			$('.J_updateUser').click(function(){
				var userInfo = {
				    "first_name":$("input[name=first_name]").val(),
				    "last_name":$("input[name=last_name]").val(),
				    "phone":$("input[name=phone]").val(),
				}
				Ajax.call('/api/resource/User/'+usr,JSON.stringify(userInfo), update_userinfoFun, 'PUT', 'JSON', 'JSON');
				function update_userinfoFun(req) {
					console.log(req);
					alt('保存成功',1);
				}
			});
		})
	</script>
	</body>
</html>
